<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Reservation System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body { background-color: #f5f5f5; }
        .bus-card { margin: 20px 0; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .seat { display: inline-block; width: 60px; height: 60px; margin: 5px; line-height: 60px; text-align: center; border-radius: 4px; cursor: pointer; transition: all 0.3s; }
        .available { background-color: #4CAF50; color: white; }
        .occupied { background-color: #f44336; color: white; cursor: not-allowed; }
        .toast { position: fixed; bottom: 20px; right: 20px; padding: 15px; color: white; border-radius: 4px; z-index: 1000; }
        .tabs .tab a { color: #1976d2; }
        .tabs .tab a:hover { color: #0d47a1; }
        .tabs .indicator { background-color: #1976d2; }
        .input-field { margin-top: 1.5rem; }
    </style>
</head>
<body>
    <nav class="blue">
        <div class="nav-wrapper container">
            <a href="#" class="brand-logo">Bus Reservations</a>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col s12">
                <ul class="tabs">
                    <li class="tab col s3"><a class="active" href="#add-bus">Add Bus</a></li>
                    <li class="tab col s3"><a href="#reserve">Reserve Seat</a></li>
                    <li class="tab col s3"><a href="#cancel">Cancel</a></li>
                    <li class="tab col s3"><a href="#buses">View Buses</a></li>
                </ul>
            </div>

            <!-- Add Bus Tab -->
            <div id="add-bus" class="col s12">
                <div class="card-panel">
                    <h5>Add New Bus</h5>
                    <form id="addBusForm">
                        <div class="row">
                            <div class="input-field col s6">
                                <input type="text" id="busNumber" required>
                                <label for="busNumber">Bus Number</label>
                            </div>
                            <div class="input-field col s6">
                                <input type="text" id="driver" required>
                                <label for="driver">Driver Name</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s6">
                                <input type="text" id="from" required>
                                <label for="from">From Location</label>
                            </div>
                            <div class="input-field col s6">
                                <input type="text" id="to" required>
                                <label for="to">To Location</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s6">
                                <input type="time" id="arrival" required>
                                <label for="arrival">Arrival Time</label>
                            </div>
                            <div class="input-field col s6">
                                <input type="time" id="depart" required>
                                <label for="depart">Departure Time</label>
                            </div>
                        </div>
                        <button class="btn waves-effect waves-light blue" type="submit">
                            Add Bus <i class="material-icons right">add</i>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Reserve Seat Tab -->
            <div id="reserve" class="col s12">
                <div class="card-panel">
                    <h5>Reserve Seat</h5>
                    <form id="reserveForm">
                        <div class="row">
                            <div class="input-field col s6">
                                <input type="text" id="reserveBusNumber" required>
                                <label for="reserveBusNumber">Bus Number</label>
                            </div>
                            <div class="input-field col s6">
                                <input type="number" id="seatNumber" min="1" max="32" required>
                                <label for="seatNumber">Seat Number (1-32)</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s12">
                                <input type="text" id="passengerName" required>
                                <label for="passengerName">Passenger Name</label>
                            </div>
                        </div>
                        <button class="btn waves-effect waves-light green" type="submit">
                            Reserve <i class="material-icons right">check</i>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Cancel Reservation Tab -->
            <div id="cancel" class="col s12">
                <div class="card-panel">
                    <h5>Cancel Reservation</h5>
                    <form id="cancelForm">
                        <div class="row">
                            <div class="input-field col s6">
                                <input type="text" id="cancelBusNumber" required>
                                <label for="cancelBusNumber">Bus Number</label>
                            </div>
                            <div class="input-field col s6">
                                <input type="number" id="cancelSeatNumber" min="1" max="32" required>
                                <label for="cancelSeatNumber">Seat Number (1-32)</label>
                            </div>
                        </div>
                        <button class="btn waves-effect waves-light red" type="submit">
                            Cancel <i class="material-icons right">close</i>
                        </button>
                    </form>
                </div>
            </div>

            <!-- View Buses Tab -->
            <div id="buses" class="col s12">
                <div id="buses-list" class="row"></div>
            </div>
        </div>
    </div>

    <script>
        class BusSystem {
            constructor() {
                this.buses = JSON.parse(localStorage.getItem('buses')) || [];
                this.initializeEventListeners();
                M.AutoInit();
                this.renderBuses();
            }

            initializeEventListeners() {
                document.getElementById('addBusForm').addEventListener('submit', (e) => this.handleAddBus(e));
                document.getElementById('reserveForm').addEventListener('submit', (e) => this.handleReserve(e));
                document.getElementById('cancelForm').addEventListener('submit', (e) => this.handleCancel(e));
            }

            handleAddBus(e) {
                e.preventDefault();
                try {
                    this.addBus({
                        number: document.getElementById('busNumber').value,
                        driver: document.getElementById('driver').value,
                        from: document.getElementById('from').value,
                        to: document.getElementById('to').value,
                        arrival: document.getElementById('arrival').value,
                        depart: document.getElementById('depart').value
                    });
                    this.showToast('Bus added successfully!', 'green');
                    e.target.reset();
                } catch (error) {
                    this.showToast(error, 'red');
                }
            }

            handleReserve(e) {
                e.preventDefault();
                try {
                    this.reserveSeat(
                        document.getElementById('reserveBusNumber').value,
                        parseInt(document.getElementById('seatNumber').value),
                        document.getElementById('passengerName').value
                    );
                    this.showToast('Reservation successful!', 'green');
                    e.target.reset();
                } catch (error) {
                    this.showToast(error, 'red');
                }
            }

            handleCancel(e) {
                e.preventDefault();
                try {
                    this.cancelReservation(
                        document.getElementById('cancelBusNumber').value,
                        parseInt(document.getElementById('cancelSeatNumber').value)
                    );
                    this.showToast('Cancellation successful!', 'green');
                    e.target.reset();
                } catch (error) {
                    this.showToast(error, 'red');
                }
            }

            addBus(bus) {
                if (this.buses.length >= 5) throw 'Maximum 5 buses allowed!';
                if (this.buses.some(b => b.number === bus.number)) throw 'Bus number already exists!';
                
                this.buses.push({
                    ...bus,
                    seats: Array.from({length: 32}, (_, i) => ({
                        number: i + 1,
                        passenger: null,
                        status: 'available'
                    }))
                });
                this.save();
                this.renderBuses();
            }

            reserveSeat(busNumber, seatNumber, passenger) {
                const bus = this.buses.find(b => b.number === busNumber);
                if (!bus) throw 'Bus not found!';
                if (seatNumber < 1 || seatNumber > 32) throw 'Invalid seat number!';
                
                const seat = bus.seats[seatNumber - 1];
                if (seat.status !== 'available') throw 'Seat already occupied!';
                
                seat.passenger = passenger;
                seat.status = 'occupied';
                this.save();
                this.renderBuses();
            }

            cancelReservation(busNumber, seatNumber) {
                const bus = this.buses.find(b => b.number === busNumber);
                if (!bus) throw 'Bus not found!';
                if (seatNumber < 1 || seatNumber > 32) throw 'Invalid seat number!';
                
                const seat = bus.seats[seatNumber - 1];
                if (seat.status !== 'occupied') throw 'Seat is not occupied!';
                
                seat.passenger = null;
                seat.status = 'available';
                this.save();
                this.renderBuses();
            }

            save() {
                localStorage.setItem('buses', JSON.stringify(this.buses));
            }

            renderBuses() {
                const container = document.getElementById('buses-list');
                container.innerHTML = '';
                
                this.buses.forEach(bus => {
                    const busCard = document.createElement('div');
                    busCard.className = 'col s12 m6';
                    busCard.innerHTML = `
                        <div class="card bus-card">
                            <div class="card-content">
                                <span class="card-title">${bus.number} - ${bus.from} to ${bus.to}</span>
                                <p>Driver: ${bus.driver}</p>
                                <p>Timing: ${bus.arrival} - ${bus.depart}</p>
                                <div class="seats-container"></div>
                            </div>
                        </div>
                    `;
                    
                    const seatsContainer = busCard.querySelector('.seats-container');
                    bus.seats.forEach(seat => {
                        const seatEl = document.createElement('div');
                        seatEl.className = `seat ${seat.status}`;
                        seatEl.textContent = seat.number;
                        seatEl.title = seat.passenger || 'Available';
                        seatsContainer.appendChild(seatEl);
                    });
                    
                    container.appendChild(busCard);
                });
            }

            showToast(message, color) {
                const toast = document.createElement('div');
                toast.className = `toast ${color}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }
        }

        // Initialize the system
        new BusSystem();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</body>
</html>